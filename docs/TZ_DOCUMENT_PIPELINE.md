# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –ü–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω —Ä–∞–±–æ—Ç—ã —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 2025-12-06
**–°—Ç–∞—Ç—É—Å:** Draft

---

## 1. –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

### 1.1 –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –¥–ª—è Repo Auditor, –≤–∫–ª—é—á–∞—é—â–µ–π:
- –ó–∞–≥—Ä—É–∑–∫—É –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤, –ø–æ–ª–∏—Ç–∏–∫, —à–∞–±–ª–æ–Ω–æ–≤
- –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (LLM + –ø–∞—Ç—Ç–µ—Ä–Ω—ã)
- –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –∞–Ω–∞–ª–∏–∑–∞–º–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—é –æ—Ç—á—ë—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —ç–∫—Å–ø–æ—Ä—Ç–∞

### 1.2 –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–æ–±–ª–µ–º–∞ |
|-----------|--------|----------|
| Contract Parser | –ß–∞—Å—Ç–∏—á–Ω–æ | –¢–æ–ª—å–∫–æ regex, –¥–∞–Ω–Ω—ã–µ –≤ –ø–∞–º—è—Ç–∏ |
| Document Storage | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | –ù–µ—Ç –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è |
| LLM Extraction | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | –¢–æ–ª—å–∫–æ –ø–∞—Ç—Ç–µ—Ä–Ω—ã |
| Contract‚ÜîAnalysis Link | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | –ù–µ—Ç —Å–≤—è–∑–∏ –≤ –ë–î |
| Multi-storage | –ß–∞—Å—Ç–∏—á–Ω–æ | –¢–æ–ª—å–∫–æ Google Drive |
| Report Generation | –ß–∞—Å—Ç–∏—á–Ω–æ | PDF/Word –Ω–µ–ø–æ–ª–Ω—ã–µ |

### 1.3 –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, –≥–¥–µ:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç/–ø–æ–ª–∏—Ç–∏–∫—É
2. –°–∏—Å—Ç–µ–º–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
3. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î –∏ —Å–≤—è–∑—ã–≤–∞—é—Ç—Å—è —Å –∞–Ω–∞–ª–∏–∑–æ–º
4. –ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
5. –î–æ–∫—É–º–µ–Ω—Ç—ã –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ —Ä–∞–∑–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

---

## 2. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 2.1 –ú–æ–¥—É–ª—å –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (Upload Module)

#### 2.1.1 –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

| –ò—Å—Ç–æ—á–Ω–∏–∫ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|----------|----------|-----------|
| Local Upload | –ó–∞–≥—Ä—É–∑–∫–∞ —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | P0 |
| Google Drive | –í—ã–±–æ—Ä –∏–∑ Google Drive | P0 |
| Direct Paste | –í—Å—Ç–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞ –Ω–∞–ø—Ä—è–º—É—é | P1 |
| URL Import | –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ —Å—Å—ã–ª–∫–µ | P2 |
| Email Import | –ü–∞—Ä—Å–∏–Ω–≥ –≤–ª–æ–∂–µ–Ω–∏–π –∏–∑ email | P3 |

#### 2.1.2 –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

| –§–æ—Ä–º–∞—Ç | –†–∞—Å—à–∏—Ä–µ–Ω–∏—è | –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ |
|--------|------------|------------|
| PDF | .pdf | PyPDF2, pdfplumber |
| Word | .docx, .doc | python-docx |
| Text | .txt, .md | built-in |
| Excel | .xlsx, .xls | openpyxl |
| Images | .png, .jpg | pytesseract (OCR) |
| Scans | .pdf (scanned) | pytesseract + pdf2image |

#### 2.1.3 API Endpoints

```
POST /api/documents/upload
  - multipart/form-data
  - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: file, document_type, analysis_id (optional)
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: document_id, extracted_preview

POST /api/documents/upload-from-drive
  - JSON: { drive_file_id, document_type, analysis_id }

POST /api/documents/upload-text
  - JSON: { content, document_type, title, analysis_id }

POST /api/documents/upload-url
  - JSON: { url, document_type, analysis_id }
```

---

### 2.2 –ú–æ–¥—É–ª—å —Ö—Ä–∞–Ω–µ–Ω–∏—è (Storage Module)

#### 2.2.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```sql
-- –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
CREATE TABLE documents (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    title VARCHAR(500) NOT NULL,
    document_type VARCHAR(50) NOT NULL, -- contract, policy, template, report
    file_name VARCHAR(255),
    mime_type VARCHAR(100),
    file_size INTEGER,

    -- –ö–æ–Ω—Ç–µ–Ω—Ç
    original_content BYTEA,           -- –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª
    extracted_text TEXT,              -- –ò–∑–≤–ª–µ—á—ë–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç

    -- –°–≤—è–∑–∏
    analysis_id UUID REFERENCES analyses(id),
    parent_document_id UUID REFERENCES documents(id), -- –î–ª—è –≤–µ—Ä—Å–∏–π

    -- –°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏
    processing_status VARCHAR(20) DEFAULT 'pending',
    processing_error TEXT,

    -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
    extraction_confidence FLOAT,
    extraction_method VARCHAR(50),    -- regex, llm, hybrid

    -- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    processed_at TIMESTAMP,

    -- Soft delete
    deleted_at TIMESTAMP
);

-- –ò–∑–≤–ª–µ—á—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
CREATE TABLE contract_data (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    document_id UUID REFERENCES documents(id) ON DELETE CASCADE,

    -- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
    contract_number VARCHAR(100),
    contract_title VARCHAR(500),
    contract_date DATE,
    start_date DATE,
    end_date DATE,
    total_amount DECIMAL(15, 2),
    currency VARCHAR(10),

    -- –°—Ç–æ—Ä–æ–Ω—ã
    client_name VARCHAR(255),
    client_address TEXT,
    contractor_name VARCHAR(255),
    contractor_address TEXT,

    -- JSON –¥–∞–Ω–Ω—ã–µ
    work_plan JSONB,          -- [{phase, description, duration, deliverables}]
    budget_breakdown JSONB,   -- [{category, amount, description}]
    milestones JSONB,         -- [{name, date, deliverable, payment}]
    indicators JSONB,         -- [{name, target, measurement}]

    -- –ò–∑–≤–ª–µ—á—ë–Ω–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏
    policies JSONB,           -- [{type, requirement, source_text}]

    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- –ò–∑–≤–ª–µ—á—ë–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
CREATE TABLE extraction_patterns (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    pattern_type VARCHAR(50),     -- date, amount, activity, deliverable
    pattern_regex TEXT,
    pattern_examples JSONB,       -- –ü—Ä–∏–º–µ—Ä—ã —É—Å–ø–µ—à–Ω—ã—Ö –∏–∑–≤–ª–µ—á–µ–Ω–∏–π
    confidence_score FLOAT,
    usage_count INTEGER DEFAULT 0,

    created_at TIMESTAMP DEFAULT NOW(),
    last_used_at TIMESTAMP
);

-- –ò—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
CREATE TABLE document_versions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    document_id UUID REFERENCES documents(id),
    version_number INTEGER,
    changes_summary TEXT,
    previous_content BYTEA,
    created_at TIMESTAMP DEFAULT NOW(),
    created_by VARCHAR(255)
);

-- –°–≤—è–∑—å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –∞–Ω–∞–ª–∏–∑–∞–º–∏ (many-to-many)
CREATE TABLE document_analysis_links (
    document_id UUID REFERENCES documents(id),
    analysis_id UUID REFERENCES analyses(id),
    link_type VARCHAR(50),        -- source_contract, reference, generated
    created_at TIMESTAMP DEFAULT NOW(),
    PRIMARY KEY (document_id, analysis_id)
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_documents_type ON documents(document_type);
CREATE INDEX idx_documents_analysis ON documents(analysis_id);
CREATE INDEX idx_documents_status ON documents(processing_status);
CREATE INDEX idx_contract_data_dates ON contract_data(start_date, end_date);
```

#### 2.2.2 –ú–æ–¥–µ–ª–∏ SQLAlchemy

```python
# app/core/models/document.py

class Document(Base):
    __tablename__ = "documents"

    id = Column(UUID, primary_key=True, default=uuid4)
    title = Column(String(500), nullable=False)
    document_type = Column(String(50), nullable=False)  # contract, policy, template
    file_name = Column(String(255))
    mime_type = Column(String(100))
    file_size = Column(Integer)

    original_content = Column(LargeBinary)
    extracted_text = Column(Text)

    analysis_id = Column(UUID, ForeignKey("analyses.id"))
    parent_document_id = Column(UUID, ForeignKey("documents.id"))

    processing_status = Column(String(20), default="pending")
    processing_error = Column(Text)
    extraction_confidence = Column(Float)
    extraction_method = Column(String(50))

    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    processed_at = Column(DateTime)
    deleted_at = Column(DateTime)

    # Relationships
    analysis = relationship("Analysis", back_populates="documents")
    contract_data = relationship("ContractData", back_populates="document", uselist=False)
    versions = relationship("DocumentVersion", back_populates="document")


class ContractData(Base):
    __tablename__ = "contract_data"

    id = Column(UUID, primary_key=True, default=uuid4)
    document_id = Column(UUID, ForeignKey("documents.id", ondelete="CASCADE"))

    contract_number = Column(String(100))
    contract_title = Column(String(500))
    contract_date = Column(Date)
    start_date = Column(Date)
    end_date = Column(Date)
    total_amount = Column(Numeric(15, 2))
    currency = Column(String(10))

    client_name = Column(String(255))
    contractor_name = Column(String(255))

    work_plan = Column(JSONB)
    budget_breakdown = Column(JSONB)
    milestones = Column(JSONB)
    indicators = Column(JSONB)
    policies = Column(JSONB)

    document = relationship("Document", back_populates="contract_data")
```

#### 2.2.3 –í–∞—Ä–∏–∞–Ω—Ç—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤

| –•—Ä–∞–Ω–∏–ª–∏—â–µ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è |
|-----------|---------------|--------------|
| PostgreSQL BYTEA | –ú–∞–ª—ã–µ —Ñ–∞–π–ª—ã (<10MB) | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| Local Filesystem | –°—Ä–µ–¥–Ω–∏–µ —Ñ–∞–π–ª—ã | STORAGE_PATH |
| S3/MinIO | –ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã, –ø—Ä–æ–¥–∞–∫—à–Ω | S3_* –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| Google Drive | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º | GOOGLE_* –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |

```python
# app/services/file_storage.py

class FileStorageService:
    """–ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –Ω–∞–¥ —Ä–∞–∑–Ω—ã–º–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞–º–∏ —Ñ–∞–π–ª–æ–≤."""

    def __init__(self):
        self.backend = self._get_backend()

    def _get_backend(self) -> StorageBackend:
        storage_type = settings.FILE_STORAGE_TYPE  # db, local, s3, gdrive

        if storage_type == "db":
            return DatabaseStorage()
        elif storage_type == "local":
            return LocalFileStorage(settings.STORAGE_PATH)
        elif storage_type == "s3":
            return S3Storage(
                bucket=settings.S3_BUCKET,
                access_key=settings.S3_ACCESS_KEY,
                secret_key=settings.S3_SECRET_KEY,
            )
        elif storage_type == "gdrive":
            return GoogleDriveStorage()

    async def store(self, content: bytes, filename: str, metadata: dict) -> str:
        """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª, –≤–µ—Ä–Ω—É—Ç—å storage_key."""
        return await self.backend.store(content, filename, metadata)

    async def retrieve(self, storage_key: str) -> bytes:
        """–ü–æ–ª—É—á–∏—Ç—å —Ñ–∞–π–ª –ø–æ –∫–ª—é—á—É."""
        return await self.backend.retrieve(storage_key)

    async def delete(self, storage_key: str) -> bool:
        """–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª."""
        return await self.backend.delete(storage_key)
```

---

### 2.3 –ú–æ–¥—É–ª—å –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (Extraction Module)

#### 2.3.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    EXTRACTION PIPELINE                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ
‚îÇ  ‚îÇ  OCR     ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Text    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Clean   ‚îÇ              ‚îÇ
‚îÇ  ‚îÇ (images) ‚îÇ    ‚îÇ Extract  ‚îÇ    ‚îÇ  & Norm  ‚îÇ              ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ
‚îÇ                                       ‚îÇ                      ‚îÇ
‚îÇ                                       ‚ñº                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ              HYBRID EXTRACTION ENGINE                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ   Regex     ‚îÇ  ‚îÇ    LLM      ‚îÇ  ‚îÇ  Template   ‚îÇ    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  Patterns   ‚îÇ  ‚îÇ  Analysis   ‚îÇ  ‚îÇ  Matching   ‚îÇ    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ         ‚îÇ                ‚îÇ                ‚îÇ            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                          ‚ñº                             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ   Result Merger     ‚îÇ                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ  + Confidence Score ‚îÇ                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                          ‚îÇ                                   ‚îÇ
‚îÇ                          ‚ñº                                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ              VALIDATION & ENRICHMENT                    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Schema validation                                    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Cross-reference check                                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Missing field detection                              ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                          ‚îÇ                                   ‚îÇ
‚îÇ                          ‚ñº                                   ‚îÇ
‚îÇ               ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                      ‚îÇ
‚îÇ               ‚îÇ   Structured Data    ‚îÇ                      ‚îÇ
‚îÇ               ‚îÇ   (ContractData)     ‚îÇ                      ‚îÇ
‚îÇ               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### 2.3.2 LLM Extraction Service

```python
# app/services/llm_extraction.py

from typing import Optional, Dict, Any, List
from pydantic import BaseModel

class ExtractionResult(BaseModel):
    """–†–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö."""
    field_name: str
    value: Any
    confidence: float  # 0.0 - 1.0
    source_text: str   # –û—Ç–∫—É–¥–∞ –∏–∑–≤–ª–µ—á–µ–Ω–æ
    method: str        # regex, llm, template


class ContractExtractionSchema(BaseModel):
    """–°—Ö–µ–º–∞ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞."""
    contract_number: Optional[str]
    contract_title: Optional[str]
    contract_date: Optional[str]
    parties: List[Dict[str, str]]
    total_amount: Optional[float]
    currency: Optional[str]
    work_plan: List[Dict[str, Any]]
    budget: List[Dict[str, Any]]
    milestones: List[Dict[str, Any]]
    indicators: List[Dict[str, Any]]
    policies: List[Dict[str, Any]]


class LLMExtractionService:
    """–°–µ—Ä–≤–∏—Å –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é LLM."""

    EXTRACTION_PROMPT = """
    Analyze the following document and extract structured data.

    Document type: {document_type}

    Extract the following information:
    1. Contract details (number, title, date, parties, amount)
    2. Work plan (phases, activities, deliverables, timelines)
    3. Budget breakdown (categories, amounts, descriptions)
    4. Milestones (name, date, deliverable, payment amount)
    5. KPIs/Indicators (name, target value, measurement method)
    6. Policy requirements (type, requirement text)

    Return as JSON matching this schema:
    {schema}

    Document text:
    ---
    {text}
    ---

    Important:
    - Extract exact values from the text
    - Include source quotes for verification
    - Mark uncertain extractions with lower confidence
    - Use null for missing fields, don't make up data
    """

    def __init__(self):
        self.llm_client = LLMClient()
        self.regex_extractor = RegexExtractor()

    async def extract(
        self,
        text: str,
        document_type: str,
        use_llm: bool = True,
        use_regex: bool = True,
    ) -> Dict[str, ExtractionResult]:
        """
        –ì–∏–±—Ä–∏–¥–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.

        1. –°–Ω–∞—á–∞–ª–∞ regex –¥–ª—è —Ç–æ—á–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ (–¥–∞—Ç—ã, —Å—É–º–º—ã)
        2. –ó–∞—Ç–µ–º LLM –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
        3. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –ø–æ confidence
        """
        results = {}

        # Regex extraction (fast, high confidence for matches)
        if use_regex:
            regex_results = await self.regex_extractor.extract(text)
            for field, result in regex_results.items():
                result.method = "regex"
                results[field] = result

        # LLM extraction (slower, better for complex structures)
        if use_llm:
            llm_results = await self._llm_extract(text, document_type)
            for field, result in llm_results.items():
                result.method = "llm"
                # Merge: prefer higher confidence
                if field not in results or result.confidence > results[field].confidence:
                    results[field] = result

        return results

    async def _llm_extract(
        self,
        text: str,
        document_type: str
    ) -> Dict[str, ExtractionResult]:
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ LLM."""
        prompt = self.EXTRACTION_PROMPT.format(
            document_type=document_type,
            schema=ContractExtractionSchema.schema_json(),
            text=text[:15000],  # Limit context
        )

        response = await self.llm_client.query(
            prompt=prompt,
            task_type="extraction",
            response_format="json",
        )

        return self._parse_llm_response(response)
```

#### 2.3.3 Regex Patterns Database

```python
# app/services/regex_patterns.py

EXTRACTION_PATTERNS = {
    # –î–∞—Ç—ã
    "date_dmy": r"\b(\d{1,2})[./-](\d{1,2})[./-](\d{4})\b",
    "date_mdy": r"\b(\d{1,2})[./-](\d{1,2})[./-](\d{4})\b",
    "date_iso": r"\b(\d{4})-(\d{2})-(\d{2})\b",
    "date_text_en": r"\b(January|February|March|April|May|June|July|August|September|October|November|December)\s+\d{1,2},?\s+\d{4}\b",
    "date_text_uk": r"\b\d{1,2}\s+(—Å—ñ—á–Ω—è|–ª—é—Ç–æ–≥–æ|–±–µ—Ä–µ–∑–Ω—è|–∫–≤—ñ—Ç–Ω—è|—Ç—Ä–∞–≤–Ω—è|—á–µ—Ä–≤–Ω—è|–ª–∏–ø–Ω—è|—Å–µ—Ä–ø–Ω—è|–≤–µ—Ä–µ—Å–Ω—è|–∂–æ–≤—Ç–Ω—è|–ª–∏—Å—Ç–æ–ø–∞–¥–∞|–≥—Ä—É–¥–Ω—è)\s+\d{4}\b",

    # –°—É–º–º—ã
    "amount_usd": r"\$\s*[\d,]+(?:\.\d{2})?",
    "amount_eur": r"‚Ç¨\s*[\d,]+(?:\.\d{2})?",
    "amount_uah": r"(?:‚Ç¥|–≥—Ä–Ω\.?|UAH)\s*[\d\s,]+(?:\.\d{2})?",
    "amount_generic": r"\b[\d,]+(?:\.\d{2})?\s*(?:USD|EUR|UAH|–≥—Ä–Ω|dollars?|euros?)\b",

    # –ù–æ–º–µ—Ä –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
    "contract_number": r"(?:Contract|–î–æ–≥–æ–≤—ñ—Ä|–ö–æ–Ω—Ç—Ä–∞–∫—Ç)\s*(?:No\.?|‚Ññ|#)\s*([A-Za-z0-9\-/]+)",

    # –°—Ä–æ–∫–∏
    "duration_days": r"(\d+)\s*(?:days?|–¥–Ω—ñ–≤|–¥–Ω—è|–¥–µ–Ω—å)",
    "duration_weeks": r"(\d+)\s*(?:weeks?|—Ç–∏–∂–Ω—ñ–≤|—Ç–∏–∂–Ω—ñ|—Ç–∏–∂–¥–µ–Ω—å)",
    "duration_months": r"(\d+)\s*(?:months?|–º—ñ—Å—è—Ü—ñ–≤|–º—ñ—Å—è—Ü—ñ|–º—ñ—Å—è—Ü—å)",

    # –≠—Ç–∞–ø—ã/—Ñ–∞–∑—ã
    "phase_pattern": r"(?:Phase|–ï—Ç–∞–ø|–§–∞–∑–∞)\s*(\d+)[:\s]*([^\n]+)",
    "milestone_pattern": r"(?:Milestone|–í–µ—Ö–∞|–ï—Ç–∞–ø)\s*(\d+)[:\s]*([^\n]+)",

    # Deliverables
    "deliverable_pattern": r"(?:Deliverable|–†–µ–∑—É–ª—å—Ç–∞—Ç|–ü—Ä–æ–¥—É–∫—Ç)\s*(\d+)?[:\s]*([^\n]+)",

    # Budget categories
    "budget_line": r"(?:\d+\.?\s*)?([A-Za-z–ê-–Ø–∞-—è–Ü—ñ–á—ó–Ñ—î\s]+)[:\s]+(?:\$|‚Ç¨|‚Ç¥|–≥—Ä–Ω)?\s*([\d,]+(?:\.\d{2})?)",
}


class RegexExtractor:
    """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ regex –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤."""

    def __init__(self):
        self.patterns = EXTRACTION_PATTERNS
        self.compiled = {k: re.compile(v, re.IGNORECASE | re.MULTILINE)
                        for k, v in self.patterns.items()}

    async def extract(self, text: str) -> Dict[str, ExtractionResult]:
        results = {}

        # Extract dates
        dates = self._extract_dates(text)
        if dates:
            results["dates"] = ExtractionResult(
                field_name="dates",
                value=dates,
                confidence=0.9,
                source_text=str(dates),
                method="regex"
            )

        # Extract amounts
        amounts = self._extract_amounts(text)
        if amounts:
            results["amounts"] = ExtractionResult(
                field_name="amounts",
                value=amounts,
                confidence=0.95,
                source_text=str(amounts),
                method="regex"
            )

        # ... more extractors

        return results
```

#### 2.3.4 Pattern Learning

```python
# app/services/pattern_learning.py

class PatternLearningService:
    """
    –°–µ—Ä–≤–∏—Å –æ–±—É—á–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã—Ö –∏–∑–≤–ª–µ—á–µ–Ω–∏–π.
    –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω—ã–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã.
    """

    async def learn_from_confirmation(
        self,
        document_id: str,
        field: str,
        extracted_value: Any,
        confirmed_value: Any,
        source_text: str,
    ):
        """
        –û–±—É—á–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.

        –ï—Å–ª–∏ extracted == confirmed: —É—Å–∏–ª–∏–≤–∞–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω
        –ï—Å–ª–∏ extracted != confirmed: —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω
        """
        if extracted_value == confirmed_value:
            await self._reinforce_pattern(field, source_text)
        else:
            await self._create_new_pattern(field, confirmed_value, source_text)

    async def _create_new_pattern(
        self,
        field: str,
        value: Any,
        source_text: str
    ):
        """–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–∞."""
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º LLM –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ regex
        prompt = f"""
        Create a regex pattern to extract "{value}" from text like:
        "{source_text}"

        Return only the regex pattern, nothing else.
        """

        pattern = await self.llm_client.query(prompt, task_type="pattern_generation")

        # Validate pattern
        if re.search(pattern, source_text):
            await self.pattern_repo.create(
                pattern_type=field,
                pattern_regex=pattern,
                pattern_examples=[{"source": source_text, "value": value}],
                confidence_score=0.5,  # Start low, increase with usage
            )
```

---

### 2.4 –ú–æ–¥—É–ª—å —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –∞–Ω–∞–ª–∏–∑–∞–º–∏ (Linking Module)

#### 2.4.1 –¢–∏–ø—ã —Å–≤—è–∑–µ–π

| –¢–∏–ø —Å–≤—è–∑–∏ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|-----------|----------|--------|
| source_contract | –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ | –î–æ–≥–æ–≤–æ—Ä ‚Üí –ê–Ω–∞–ª–∏–∑ —Ä–µ–ø–æ |
| reference | –°–ø—Ä–∞–≤–æ—á–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç | –ü–æ–ª–∏—Ç–∏–∫–∞ ‚Üí –ê–Ω–∞–ª–∏–∑ |
| generated | –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á—ë—Ç | –ê–Ω–∞–ª–∏–∑ ‚Üí PDF –æ—Ç—á—ë—Ç |
| comparison | –î–æ–∫—É–º–µ–Ω—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è | –ö–æ–Ω—Ç—Ä–∞–∫—Ç + –ê–Ω–∞–ª–∏–∑ ‚Üí –°—Ä–∞–≤–Ω–µ–Ω–∏–µ |

#### 2.4.2 API –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è

```python
# app/api/routes/document_links.py

@router.post("/documents/{document_id}/link")
async def link_document_to_analysis(
    document_id: UUID,
    request: LinkRequest,
    db: AsyncSession = Depends(get_db),
):
    """
    –°–≤—è–∑–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç —Å –∞–Ω–∞–ª–∏–∑–æ–º.

    Request:
    {
        "analysis_id": "uuid",
        "link_type": "source_contract" | "reference" | "generated"
    }
    """
    pass


@router.get("/analysis/{analysis_id}/documents")
async def get_analysis_documents(
    analysis_id: UUID,
    link_type: Optional[str] = None,
    db: AsyncSession = Depends(get_db),
):
    """–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∞–Ω–∞–ª–∏–∑–æ–º."""
    pass


@router.get("/documents/{document_id}/analyses")
async def get_document_analyses(
    document_id: UUID,
    db: AsyncSession = Depends(get_db),
):
    """–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∞–Ω–∞–ª–∏–∑—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –¥–æ–∫—É–º–µ–Ω—Ç–æ–º."""
    pass
```

#### 2.4.3 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ

```python
# app/services/auto_linker.py

class AutoLinkerService:
    """
    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –∏ –∞–Ω–∞–ª–∏–∑–∞–º–∏.
    """

    async def suggest_links(
        self,
        document_id: UUID
    ) -> List[SuggestedLink]:
        """
        –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Å–≤—è–∑–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ:
        1. –°–æ–≤–ø–∞–¥–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–æ–≤
        2. –°–æ–≤–ø–∞–¥–µ–Ω–∏—è –¥–∞—Ç
        3. –°–æ–≤–ø–∞–¥–µ–Ω–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω URL)
        4. –¢–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å—Ö–æ–¥—Å—Ç–≤–∞
        """
        document = await self.doc_repo.get(document_id)
        contract_data = document.contract_data

        suggestions = []

        # –ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é –ø—Ä–æ–µ–∫—Ç–∞
        if contract_data and contract_data.contract_title:
            analyses = await self.analysis_repo.search_by_name(
                contract_data.contract_title
            )
            for analysis in analyses:
                suggestions.append(SuggestedLink(
                    analysis_id=analysis.id,
                    confidence=0.8,
                    reason="Project name match",
                ))

        # –ü–æ –¥–∞—Ç–∞–º (–∞–Ω–∞–ª–∏–∑ –≤ –ø–µ—Ä–∏–æ–¥ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞)
        if contract_data and contract_data.start_date:
            analyses = await self.analysis_repo.find_in_date_range(
                start=contract_data.start_date,
                end=contract_data.end_date,
            )
            for analysis in analyses:
                suggestions.append(SuggestedLink(
                    analysis_id=analysis.id,
                    confidence=0.6,
                    reason="Date range match",
                ))

        return suggestions
```

---

### 2.5 –ú–æ–¥—É–ª—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (Generation Module)

#### 2.5.1 –¢–∏–ø—ã –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –î–æ–∫—É–º–µ–Ω—Ç—ã | –§–æ—Ä–º–∞—Ç—ã |
|-----------|-----------|---------|
| –ê—É–¥–∏—Ç | Tech Report, Quality Report, Security Report | PDF, Word, MD |
| –§–∏–Ω–∞–Ω—Å—ã | Cost Estimate, Budget Status, Act of Work | PDF, Excel |
| –î–æ–Ω–æ—Ä—Å–∫–∏–µ | Donor One-Pager, Progress Report, Indicators | PDF, Word |
| –°—Ä–∞–≤–Ω–µ–Ω–∏–µ | Contract Compliance, Variance Report | PDF, Excel |

#### 2.5.2 –®–∞–±–ª–æ–Ω–∏–∑–∞—Ü–∏—è —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤

```python
# app/services/document_generator_v2.py

class EnhancedDocumentGenerator:
    """
    –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤.
    """

    async def generate(
        self,
        document_type: str,
        analysis_id: UUID,
        format: str,
        include_contract_data: bool = True,
    ) -> bytes:
        """
        –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤–∫–ª—é—á–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.
        """
        # –ü–æ–ª—É—á–∞–µ–º –∞–Ω–∞–ª–∏–∑
        analysis = await self.analysis_repo.get(analysis_id)

        # –ü–æ–ª—É—á–∞–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
        contracts = []
        if include_contract_data:
            linked_docs = await self.link_repo.get_by_analysis(
                analysis_id,
                link_type="source_contract"
            )
            for doc in linked_docs:
                if doc.contract_data:
                    contracts.append(doc.contract_data)

        # –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        data = {
            "analysis": analysis.to_dict(),
            "metrics": analysis.metrics.to_dict() if analysis.metrics else {},
            "contracts": [c.to_dict() for c in contracts],
            "comparison": await self._generate_comparison(analysis, contracts),
        }

        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ —Ç–∏–ø—É
        if document_type == "compliance_report":
            return await self._generate_compliance_report(data, format)
        elif document_type == "progress_report":
            return await self._generate_progress_report(data, format)
        # ... etc

    async def _generate_comparison(
        self,
        analysis: Analysis,
        contracts: List[ContractData],
    ) -> Dict:
        """–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ (–∫–æ–Ω—Ç—Ä–∞–∫—Ç) —Å —Ñ–∞–∫—Ç–æ–º (–∞–Ω–∞–ª–∏–∑)."""
        if not contracts:
            return {}

        contract = contracts[0]  # Primary contract

        return {
            "budget": {
                "planned": contract.total_amount,
                "estimated": analysis.metrics.cost_estimates.get("typical"),
                "variance": self._calc_variance(
                    contract.total_amount,
                    analysis.metrics.cost_estimates.get("typical")
                ),
            },
            "timeline": {
                "planned_days": (contract.end_date - contract.start_date).days,
                "estimated_hours": analysis.metrics.cost_estimates.get("hours_typical"),
            },
            "deliverables": self._compare_deliverables(
                contract.work_plan,
                analysis.tasks,
            ),
            "indicators": self._compare_indicators(
                contract.indicators,
                analysis.metrics,
            ),
        }
```

#### 2.5.3 Template Engine

```python
# app/services/template_engine.py

class TemplateEngine:
    """
    –î–≤–∏–∂–æ–∫ —à–∞–±–ª–æ–Ω–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
    - Jinja2 –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤
    - DOCX templates –¥–ª—è Word
    - HTML templates –¥–ª—è PDF
    """

    def __init__(self):
        self.jinja_env = Environment(
            loader=FileSystemLoader("templates"),
            autoescape=True,
        )
        self.docx_templates = Path("templates/docx")
        self.html_templates = Path("templates/html")

    async def render_markdown(
        self,
        template_name: str,
        data: Dict
    ) -> str:
        template = self.jinja_env.get_template(f"{template_name}.md.j2")
        return template.render(**data)

    async def render_docx(
        self,
        template_name: str,
        data: Dict,
    ) -> bytes:
        """Render DOCX from template."""
        from docxtpl import DocxTemplate

        template_path = self.docx_templates / f"{template_name}.docx"
        doc = DocxTemplate(template_path)
        doc.render(data)

        buffer = io.BytesIO()
        doc.save(buffer)
        return buffer.getvalue()

    async def render_pdf(
        self,
        template_name: str,
        data: Dict,
    ) -> bytes:
        """Render PDF from HTML template."""
        template = self.jinja_env.get_template(f"{template_name}.html.j2")
        html = template.render(**data)

        from weasyprint import HTML
        return HTML(string=html).write_pdf()
```

---

### 2.6 –ú–æ–¥—É–ª—å —ç–∫—Å–ø–æ—Ä—Ç–∞ –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è (Export Module)

#### 2.6.1 –í–∞—Ä–∏–∞–Ω—Ç—ã —ç–∫—Å–ø–æ—Ä—Ç–∞

| Destination | –ú–µ—Ç–æ–¥ | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è |
|-------------|-------|--------------|
| Local Download | HTTP Response | - |
| Google Drive | API | GOOGLE_* |
| Email | SMTP | SMTP_* |
| Webhook | HTTP POST | WEBHOOK_URL |
| S3 Bucket | AWS SDK | S3_* |
| Slack | Webhook | SLACK_WEBHOOK |

#### 2.6.2 Export API

```python
# app/api/routes/export_v2.py

@router.post("/documents/{document_id}/export")
async def export_document(
    document_id: UUID,
    request: ExportRequest,
):
    """
    –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞.

    Request:
    {
        "destination": "download" | "gdrive" | "email" | "s3" | "slack",
        "format": "pdf" | "docx" | "xlsx" | "md",
        "options": {
            // –î–ª—è gdrive
            "folder_id": "...",

            // –î–ª—è email
            "recipients": ["email@example.com"],
            "subject": "...",

            // –î–ª—è s3
            "bucket": "...",
            "key": "...",

            // –î–ª—è slack
            "channel": "#reports",
            "message": "..."
        }
    }
    """
    pass


@router.post("/analysis/{analysis_id}/export-package")
async def export_document_package(
    analysis_id: UUID,
    request: PackageExportRequest,
):
    """
    –≠–∫—Å–ø–æ—Ä—Ç –ø–∞–∫–µ—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.

    Request:
    {
        "document_types": ["tech_report", "cost_estimate", "task_list"],
        "format": "pdf",
        "destination": "gdrive",
        "create_folder": true,
        "folder_name": "Audit Report {date}"
    }
    """
    pass
```

#### 2.6.3 Scheduled Export

```python
# app/services/scheduled_export.py

class ScheduledExportService:
    """
    –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞.
    """

    async def schedule_export(
        self,
        analysis_id: UUID,
        schedule: str,  # cron expression
        export_config: ExportConfig,
    ):
        """
        –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç.

        –ù–∞–ø—Ä–∏–º–µ—Ä: –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–æ–Ω–æ—Ä—É.
        """
        pass

    async def run_scheduled_exports(self):
        """–ó–∞–ø—É—Å–∫ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ cron/celery)."""
        pass
```

---

## 3. –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 3.1 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ |
|---------|------------|
| –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ <10MB | < 3 —Å–µ–∫ |
| –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ (regex) | < 1 —Å–µ–∫ |
| –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ (LLM) | < 30 —Å–µ–∫ |
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF | < 5 —Å–µ–∫ |
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Excel | < 3 —Å–µ–∫ |

### 3.2 –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ 10,000 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ 10 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á –¥–ª—è —Ç—è–∂—ë–ª—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (Celery/RQ)

### 3.3 –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ at rest (AES-256)
- RBAC –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º
- Audit log –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ N –¥–Ω–µ–π (configurable)

### 3.4 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

| –°–∏—Å—Ç–µ–º–∞ | –¢–∏–ø –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ | –°—Ç–∞—Ç—É—Å |
|---------|----------------|--------|
| Google Drive | OAuth 2.0 + API | –ï—Å—Ç—å |
| LLM (Claude/GPT) | API | –ß–∞—Å—Ç–∏—á–Ω–æ |
| PostgreSQL | Direct | –ï—Å—Ç—å |
| S3/MinIO | AWS SDK | –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è |
| Email (SMTP) | Direct | –ß–∞—Å—Ç–∏—á–Ω–æ |
| Slack | Webhook | –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è |

---

## 4. UI/UX —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 4.1 –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Upload Document                                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ     üìÅ Drop files here or click to browse               ‚îÇ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ‚îÇ
‚îÇ  ‚îÇ     Supported: PDF, DOCX, XLSX, TXT                     ‚îÇ‚îÇ
‚îÇ  ‚îÇ                                                          ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ OR ‚îÄ‚îÄ‚îÄ                                                  ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  [üìÅ Google Drive]  [üìã Paste Text]  [üîó From URL]          ‚îÇ
‚îÇ                                                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Document Type:  [Contract ‚ñº]                                ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  Link to Analysis: [Select or create new... ‚ñº]              ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  [Upload & Process]                                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 4.2 –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Contract: Project Alpha Agreement                           ‚îÇ
‚îÇ  Status: ‚úÖ Processed  |  Confidence: 87%                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                              ‚îÇ
‚îÇ  [Overview] [Work Plan] [Budget] [Indicators] [Raw Text]    ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ Field                 ‚îÇ Extracted Value          [Edit] ‚îÇ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§‚îÇ
‚îÇ  ‚îÇ Contract Number       ‚îÇ PA-2024-001              ‚úÖ     ‚îÇ‚îÇ
‚îÇ  ‚îÇ Contract Date         ‚îÇ January 15, 2024         ‚úÖ     ‚îÇ‚îÇ
‚îÇ  ‚îÇ Total Amount          ‚îÇ $150,000 USD             ‚úÖ     ‚îÇ‚îÇ
‚îÇ  ‚îÇ Start Date            ‚îÇ February 1, 2024         ‚úÖ     ‚îÇ‚îÇ
‚îÇ  ‚îÇ End Date              ‚îÇ December 31, 2024        ‚ö†Ô∏è     ‚îÇ‚îÇ
‚îÇ  ‚îÇ Client                ‚îÇ ACME Foundation          ‚úÖ     ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ‚ö†Ô∏è Low confidence fields need review                        ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  [Confirm All]  [Link to Analysis]  [Generate Reports]       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 4.3 –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç vs –∞–Ω–∞–ª–∏–∑

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Contract vs Analysis Comparison                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Contract: PA-2024-001  ‚Üî  Analysis: repo-xyz               ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  Overall Status: ‚ö†Ô∏è AT RISK                                  ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ Budget Comparison                                        ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚îÇ Planned:   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà $150,000   ‚îÇ          ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚îÇ Estimated: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà $165,000 ‚îÇ          ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚îÇ                                 +10% ‚ö†Ô∏è     ‚îÇ          ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ Deliverables Progress                                    ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚òë Phase 1: Requirements Analysis     ‚úÖ Complete         ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚òë Phase 2: Development               üîÑ In Progress      ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚òê Phase 3: Testing                   ‚è≥ Pending          ‚îÇ‚îÇ
‚îÇ  ‚îÇ ‚òê Phase 4: Deployment                ‚è≥ Pending          ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  [Download Report]  [Send to Stakeholders]  [Schedule Update]‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 5. –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –§–∞–∑–∞ 1: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (2 –Ω–µ–¥–µ–ª–∏)

| –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –û—Ü–µ–Ω–∫–∞ |
|--------|-----------|--------|
| –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (documents, contract_data) | P0 | 4h |
| SQLAlchemy –º–æ–¥–µ–ª–∏ | P0 | 4h |
| File Storage Service (–∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è) | P0 | 8h |
| Document Repository | P0 | 4h |
| Upload API endpoints | P0 | 8h |
| Unit tests | P0 | 8h |

### –§–∞–∑–∞ 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (2 –Ω–µ–¥–µ–ª–∏)

| –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –û—Ü–µ–Ω–∫–∞ |
|--------|-----------|--------|
| –£–ª—É—á—à–µ–Ω–Ω—ã–π Regex Extractor | P0 | 8h |
| LLM Extraction Service | P0 | 16h |
| Hybrid Extraction Pipeline | P0 | 8h |
| Confidence Scoring | P1 | 4h |
| Pattern Learning Service | P2 | 8h |
| Integration tests | P0 | 8h |

### –§–∞–∑–∞ 3: –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ (1 –Ω–µ–¥–µ–ª—è)

| –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –û—Ü–µ–Ω–∫–∞ |
|--------|-----------|--------|
| Document-Analysis linking API | P0 | 4h |
| Auto-linker suggestions | P1 | 8h |
| Enhanced comparison service | P0 | 8h |
| Comparison reports | P0 | 8h |

### –§–∞–∑–∞ 4: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (2 –Ω–µ–¥–µ–ª–∏)

| –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –û—Ü–µ–Ω–∫–∞ |
|--------|-----------|--------|
| Template engine setup | P0 | 8h |
| DOCX templates | P0 | 16h |
| PDF templates (WeasyPrint) | P0 | 16h |
| Excel templates | P1 | 8h |
| Contract-aware generation | P0 | 8h |

### –§–∞–∑–∞ 5: UI –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (2 –Ω–µ–¥–µ–ª–∏)

| –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –û—Ü–µ–Ω–∫–∞ |
|--------|-----------|--------|
| Upload page UI | P0 | 8h |
| Extracted data review UI | P0 | 12h |
| Comparison dashboard | P0 | 12h |
| Multi-export destinations | P1 | 8h |
| Slack/Email integration | P2 | 8h |

### –§–∞–∑–∞ 6: –ü–æ–ª–∏—Ä–æ–≤–∫–∞ –∏ —Ç–µ—Å—Ç—ã (1 –Ω–µ–¥–µ–ª—è)

| –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –û—Ü–µ–Ω–∫–∞ |
|--------|-----------|--------|
| E2E tests | P0 | 16h |
| Performance optimization | P1 | 8h |
| Documentation | P0 | 8h |
| Bug fixes | P0 | 8h |

---

## 6. –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|---------|-----------|
| LLM extraction –Ω–µ—Ç–æ—á–µ–Ω | –í—ã—Å–æ–∫–∞—è | –°—Ä–µ–¥–Ω–µ–µ | Hybrid approach + manual review |
| –ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã —Ç–æ—Ä–º–æ–∑—è—Ç | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω–µ–µ | Async processing + progress |
| –†–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ | –í—ã—Å–æ–∫–∞—è | –í—ã—Å–æ–∫–æ–µ | Configurable patterns + learning |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GDrive –ª–æ–º–∞–µ—Ç—Å—è | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–æ–µ | Fallback to local storage |

---

## 7. –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | Target |
|---------|--------|
| Extraction accuracy | > 85% |
| Processing time (avg) | < 10 sec |
| User confirmation rate | > 90% |
| Documents processed/day | > 100 |
| Report generation errors | < 1% |

---

## 8. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### A. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

```
backend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ api/routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ documents.py      # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ document_upload.py # –ù–æ–≤—ã–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ document_links.py  # –ù–æ–≤—ã–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ export_v2.py       # –ù–æ–≤—ã–π
‚îÇ   ‚îú‚îÄ‚îÄ core/models/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ document.py        # –ù–æ–≤—ã–π
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ contract_parser.py # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π (—Ä–∞—Å—à–∏—Ä–∏—Ç—å)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ llm_extraction.py  # –ù–æ–≤—ã–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ file_storage.py    # –ù–æ–≤—ã–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pattern_learning.py # –ù–æ–≤—ã–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auto_linker.py     # –ù–æ–≤—ã–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ template_engine.py  # –ù–æ–≤—ã–π
‚îÇ   ‚îî‚îÄ‚îÄ repositories/
‚îÇ       ‚îî‚îÄ‚îÄ document_repo.py    # –ù–æ–≤—ã–π
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îú‚îÄ‚îÄ docx/                   # Word —à–∞–±–ª–æ–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ html/                   # HTML –¥–ª—è PDF
‚îÇ   ‚îî‚îÄ‚îÄ md/                     # Markdown —à–∞–±–ª–æ–Ω—ã
‚îî‚îÄ‚îÄ migrations/
    ‚îî‚îÄ‚îÄ versions/
        ‚îî‚îÄ‚îÄ xxx_add_documents.py # –ù–æ–≤—ã–π
```

### B. Environment Variables

```env
# File Storage
FILE_STORAGE_TYPE=db  # db, local, s3, gdrive
STORAGE_PATH=/var/data/documents
MAX_FILE_SIZE_MB=50

# S3 (optional)
S3_BUCKET=repo-auditor-docs
S3_ACCESS_KEY=xxx
S3_SECRET_KEY=xxx
S3_ENDPOINT=https://s3.amazonaws.com

# LLM Extraction
LLM_EXTRACTION_ENABLED=true
LLM_EXTRACTION_PROVIDER=anthropic  # anthropic, openai
LLM_EXTRACTION_MODEL=claude-3-haiku

# Export
EXPORT_TEMP_DIR=/tmp/exports
EXPORT_RETENTION_DAYS=7
```

---

**–ö–æ–Ω–µ—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞**
